# 国旅运通国际机票需求

## 项目背景

客户订票后，为了方便用户自主申请开具电子发票，特开发功能

### 入口

我的 -> 开具电子发票

### 展示逻辑

根据配置中的enabledInvoiceProducts判断，开启的话则显示该入口

### 涉及接口

查询开发信息（searchTaProductInvoices）
查询发票抬头（loadTaProductInvoiceCustomerTypes）
申请开票（saveTaProductInvoiceRecord）
取消开票（cancelTaProductInvoiceRecord）
检验开票状态（checkTaProductInvoiceStatus）
查询开票记录（loadTaProductInvoiceRecords）

### 重点逻辑

#### 开票状态 invoiceStatus

- 0 准备中，不作为筛选状态
- 1 待开票
- 2 已提交
- 3 已取消
- 4 开票中
- 5 开票失败
- 6 已过期
- 9 开票取消
- 10 等待换开，不作为筛选状态

可供检索的状态要剔除0和10

#### 检索可供开局发票的订单类型，即业务线类型

该业务线不是简单的机、酒、火等的罗列，而是通过配置的enabledInvoiceProducts来判断

APP中，公司开具的产品线存在getAllProduct()缓存里，而enabledInvoiceProducts存在getCompanyLoginInfoAll()缓存里。H5也有类似的逻辑